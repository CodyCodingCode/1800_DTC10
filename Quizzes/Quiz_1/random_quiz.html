<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Quiz Page</title>
  <link rel="stylesheet" href="/styles/my_style.css">

  <!-- Firebase 8 CDNs-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
  <!--Firebase Authentication API Keys -->
  <script src="/scripts/firebaseAPI_DTC10.js"></script>

  <!-- Bootstrap FirebaseUI CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>

  <div class="container mt-sm-5 my-1">
    <div class="question ml-sm-5 pl-sm-5 pt-2">
      <div class="py-2 h5"><b>Question 1: </b><span id="first-goes-here"></span></div>
      <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" id="options">
        <br><br>
        <label class="options">
          <input type="radio" name="radio" id="choice_one"> <span class="checkmark" id="first_choice"></span>
          <div class="py-2 h5"><b></b><span id="second-goes-here"></span></div>
        </label>
        <!-- <div class="py-2 h5"><b></b><span id="second-goes-here"></span></div> -->
        <label class="options">
          <input type="radio" name="radio" id="choice_two"> <span class="checkmark" id="second_choice"></span>
          <div class="py-2 h5"><b></b><span id="third-goes-here"></span></div>
        </label>
        <!-- <div class="py-2 h5"><b></b><span id="third-goes-here"></span></div> -->
        <label class="options">
          <input type="radio" name="radio" id="choice_three"> <span class="checkmark" id="third_choice"></span>
          <div class="py-2 h5"><b></b><span id="fourth-goes-here"></span></div>
        </label>
        <!-- <div class="py-2 h5"><b></b><span id="fourth-goes-here"></span></div> -->
        <label class="options">
          <input type="radio" name="radio" id="choice_four"> <span class="checkmark" id="fourth_choice"></span>
          <div class="py-2 h5"><b></b><span id="fifth-goes-here"></span></div>
        </label>
        <!-- <div class="py-2 h5"><b></b><span id="fifth-goes-here"></span></div> -->
      </div>
    </div>
    <div class="d-flex align-items-center pt-3">

      <div id="prev"> <button class="btn btn-primary" onclick="confirmation_box()">Home</button></div>

      <div class="ml-auto mr-sm-5" id="buttonsubmit"> <button class="btn btn-success" id="thisisthesubmitbutton"
          onclick="myFunction()">Submit</button> </div>
      <div class="popup" onclick="myFunction()">
        <span class="popuptext" id="myPopup">You got it right!</span>
      </div>
      <a href="random_quiz.html">
        <div class="ml-auto mr-sm-5" id="buttonnext"> <button class="btn btn-secondary" id="next_button"
            style="display:none;">Next</button> </div>
      </a>
    </div>

  </div>

  <script>
    // When the user clicks home/back, confirm that they actually want to leave.
    function confirmation_box() {
      if (confirm(
          "You will have to pay another entrance fee to take the quiz again! Are you sure you want to leave?")) {
        window.location.href = "/gameplay.html"
      }
    }

    // this is the remnants of the non-random quiz, kept in case of any reversions

    // function insertName() {
    //   firebase.auth().onAuthStateChanged(user => {
    //     // Check if user is signed in:
    //     if (user) {
    //       // Do something for the current logged-in user here: 
    //       console.log('H8cjwzL3KxbOtpm36JxiSEO1g7q1');
    //       //go to the correct user document by referencing to the user uid
    //       currentUser = db.collection("Quiz_Resources").doc('Quiz_Zero');
    //       //get the document for current user.
    //       currentUser.get()
    //         .then(userDoc => {
    //           var first = userDoc.data().Question_1;
    //           var second = userDoc.data().choice_1;
    //           var third = userDoc.data().choice_2;
    //           var fourth = userDoc.data().choice_3;
    //           var fifth = userDoc.data().choice_4;
    //           // var correct = userDoc.data().choice_5;

    //           $("#first-goes-here").text(first);
    //           $("#second-goes-here").text(second); //using jquery
    //           $("#third-goes-here").text(third);
    //           $("#fourth-goes-here").text(fourth);
    //           $("#fifth-goes-here").text(fifth);
    //           // $("#correct-goes-here").text(correct);
    //         })
    //     } else {
    //       // No user is signed in.
    //     }
    //   });
    // }
    // insertName();
    var myArray = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]

    function getRandomQuestion() {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          db.collection("Quiz_Questions")
            .where("position", ">", Math.floor(Math.random() * myArray.length))
            .limit(1)
            .onSnapshot(docs => {
              docs.forEach(doc => {
                var first = doc.data().question;
                var second = doc.data().option_one;
                var third = doc.data().option_two;
                var fourth = doc.data().option_three;
                var fifth = doc.data().option_four;
                var sixth = doc.data().answer;
                if (second == sixth || third == sixth || fourth == sixth || fifth == sixth) {
                  console.log('wow does that work?')
                }
                // var questionString = "<p> " + question + "</p>";
                // $("#question-goes-here").append(questionString);
                // $("#first-goes-here").append(first);
                // $("#second-goes-here").append(second);
                $("#first-goes-here").text(first);
                $("#second-goes-here").text(second);
                $("#third-goes-here").text(third);
                $("#fourth-goes-here").text(fourth);
                $("#fifth-goes-here").text(fifth);
              })
            })
        } else {
          // No user is signed in.
        }
      });
    }
    getRandomQuestion();

    // When the user clicks on div, open the popup
    // see if a button is clicked and then see if that fieldvalue is equal to answer??
    function myFunction() {
      firebase.auth().onAuthStateChanged(user => {
        // Check if user is signed in:
        if (user) {

          //go to the correct user document by referencing to the user uid
          currentUser = db.collection("users").doc(user.uid);

          var popup = document.getElementById("myPopup");
          //added variable for the right radio button
          var rightanswer = document.querySelector("#choice_four")
          var rightanswer1 = document.querySelector('#choice_one')
          var rightanswer2 = document.querySelector('#choice_two')
          var rightanswer3 = document.querySelector('#choice_three')
          db.collection("Quiz_Questions")
            .where("position", ">", Math.floor(Math.random() * myArray.length))
            .limit(1)
            .onSnapshot(docs => {
              docs.forEach(doc => {
                var first = doc.data().question;
                var second = doc.data().option_one;
                var third = doc.data().option_two;
                var fourth = doc.data().option_three;
                var fifth = doc.data().option_four;
                var sixth = doc.data().answer;

                //if the right radio button is checked when click event occurs, right answer pop-up shows
                if (rightanswer.checked == true) {
                  if (fifth == sixth) {
                    document.getElementById("next_button").style.display = "";
                    popup.classList.toggle("show");
                    currentUser.update({
                      // increment the quiz_total in the firebase by 1 if user gets the right answer
                      quizTotal: firebase.firestore.FieldValue.increment(0.5),
                      incrementScore: firebase.firestore.FieldValue.increment(0.5),
                      score: firebase.firestore.FieldValue.increment(10)
                    })
                  } 
                  else if (fifth != sixth){
                    window.location.href = "/gameplay.html";
                  }
                }

                else if (rightanswer1.checked == true) {
                  if (second == sixth) {
                    document.getElementById("next_button").style.display = "";
                    popup.classList.toggle("show");
                    currentUser.update({
                      // increment the quiz_total in the firebase by 1 if user gets the right answer
                      quizTotal: firebase.firestore.FieldValue.increment(0.5),
                      incrementScore: firebase.firestore.FieldValue.increment(0.5),
                      score: firebase.firestore.FieldValue.increment(10)
                    })
                  } 
                  else if (second != sixth) {
                    window.location.href = "/gameplay.html";
                  }
                }

                else if (rightanswer2.checked == true) {
                  if (third == sixth) {
                    document.getElementById("next_button").style.display = "";
                    popup.classList.toggle("show");
                    currentUser.update({
                      // increment the quiz_total in the firebase by 1 if user gets the right answer
                      quizTotal: firebase.firestore.FieldValue.increment(0.5),
                      incrementScore: firebase.firestore.FieldValue.increment(0.5),
                      score: firebase.firestore.FieldValue.increment(10)
                    })
                  } 
                  else if (third != sixth){
                    window.location.href = "/gameplay.html";
                  }
                }

                else if (rightanswer3.checked == true) {
                  if (fourth == sixth) {
                    document.getElementById("next_button").style.display = "";
                    popup.classList.toggle("show");
                    currentUser.update({
                      // increment the quiz_total in the firebase by 1 if user gets the right answer
                      quizTotal: firebase.firestore.FieldValue.increment(0.5),
                      incrementScore: firebase.firestore.FieldValue.increment(0.5),
                      score: firebase.firestore.FieldValue.increment(10)
                    })
                  } 
                  else if (fourth != sixth) {
                    window.location.href = "/gameplay.html";
                  }
                }
                
              })
            });
        }
      });
    };
  </script>

</body>

</html>