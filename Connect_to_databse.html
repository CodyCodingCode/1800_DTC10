<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>My BCIT Project</title>
  <meta name="comp1800DTC10 template" content="database_template">

  <!-- Optional styles and scripts of your own -->
  <link rel="stylesheet" href="styles/my_style.css">

  <!-- Bootstrap FirebaseUI CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Firebase 8 CDNs-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

  <!-- Link to the api keys for your firebase project -->
  <script src="/scripts/firebaseAPI_DTC10.js"></script>

</head>

<body>

  <div class="container mt-sm-5 my-1">
    <div class="question ml-sm-5 pl-sm-5 pt-2">
      <div class="py-2 h5"><b>Q. What is a primary source?</b><span id="userName"></span></div>
      <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" id="options"> 
        <label class="options">The first source referenced by a writer, signalling that it is most reputable.
        <input type="radio" name="radio"> <span class="checkmark" id="first_choice"></span>
        </label>
        <label class="options">The first source used by a writer in researching their article.
          <input type="radio" name="radio"> <span class="checkmark" id="second_choice"></span>
        </label>
        <label class="options">A source with proven academic experience regarding a field directly relating to the authorâ€™s topic. 
          <input type="radio" name="radio"> <span class="checkmark" id="third_choice"></span>
        </label>
        <label class="options">A source with first-hand, personal knowledge of an event. 
          <input type="radio" name="radio"> <span class="checkmark" id="fourth_choice"></span>
        </label>
      </div>
    </div>
    <div class="d-flex align-items-center pt-3">
      <a href="quizupgrade page.html"><div id="prev"> <button class="btn btn-primary">Back</button></div></a>
      <div class="ml-auto mr-sm-5"> <button class="btn btn-success" onclick="doQuiz()">Submit</button> </div>
    </div>
  </div>

  <script>
    let topicID = localStorage.getItem("topicID");

    db.collection("users").where("code", "==", topicID)
      .get()
      .then(queryuser => {
        //see how many results you have got from the query
        size = queryuser.size;
        // get the documents of query
        Topics = queryuser.docs;

        // We want to have one document per hike, so if the the result of 
        //the query is more than one, we can check it right now and clean the DB if needed.
        if (size = 1) {
          var thisTopic = Topics[0].data();
          name = thisTopic.name;
          // should this be quiz name or topic name
          document.getElementById("userName").innerHTML = name;
        } else {
          console.log("Query has more than one data")
        }
      })
      .catch((error) => {
        console.log("Error getting documents: ", error);
      });

    function doQuiz() {
      let first = document.getElementById("first_choice").value;
      let second = document.getElementById("second_choice").value;
      let third = document.getElementById("third_choice").value;
      let fourth = document.getElementById("fourth_choice").value;
      firebase.auth().onAuthStateChanged(user => {
        if (user) {
          var currentUser = db.collection("Quizzes").doc(user.uid)
          var userID = user.uid;
          //get the document for current user.
          currentUser.get()
            .then(userDoc => {
              //get user Email
              var userEmail = userDoc.data().email;
              // Start a new collection and add all data in it.
              db.collection("Quizzes").add({
                code: topicID,
                UserID: userID,
                UserEmail: userEmail,
                First_Choice: first,
                Second_Choice: second,
                Third_Choice: third,
                Fourth_Choice: fourth,
              });
            })
        } else {
          // No user is signed in.
          console.log("no user signed in");
        }
      });
    }
  </script>

</body>

</html>